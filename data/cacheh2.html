<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0 from src/site/markdown/data/cacheh2.md at 2025-02-16
 | Rendered using Apache Maven Fluido Skin 2.0.0-M11
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0" />
    <title>Caching ODC&apos;s H2 Database – dependency-check-maven</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-2.0.0-M11.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-2.0.0-M11.min.js"></script>
<style type="text/css">
                #bannerLeft { margin-top:-20px;margin-bottom:5px !important}
                a.externalLink[href^=https]{padding-right:inherit;background-image:none !important}
                a.externalLink[href^=http]{padding-right:inherit;background-image:none !important}
            </style>
    <style>.github-fork-ribbon:before { background-color: gray; }</style>
  </head>
  <body>
    <a class="github-fork-ribbon right-top" href="https://github.com/jeremylong/DependencyCheck" data-ribbon="Fork me on GitHub">Fork me on GitHub</a>
    <div class="container-fluid container-fluid-top">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1><img class="class java.lang.Object" src="../images/dc.svg" alt="OWASP dependency-check" /></h1></div></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
      <li><a href="https://www.owasp.org/" class="externalLink">OWASP</a><span class="divider">/</span></li>
      <li><a href="https://www.owasp.org/index.php/OWASP_Dependency_Check" class="externalLink">Dependency-Check</a><span class="divider">/</span></li>
      <li><a href="../">documentation</a><span class="divider">/</span></li>
    <li class="active">Caching ODC&apos;s H2 Database</li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2025-02-16</li>
          <li id="projectVersion" class="pull-right">Version: 12.1.0</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">OWASP dependency-check</li>
    <li><a href="../index.html"><span class="icon-chevron-down"></span>General</a>
     <ul class="nav nav-list">
      <li><a href="../general/internals.html">How it Works</a></li>
      <li><a href="../general/thereport.html">Reading the Report</a></li>
      <li><a href="../general/suppression.html">False Positives</a></li>
      <li><a href="../general/hints.html">False Negatives</a></li>
      <li><a href="../data/index.html"><span class="icon-chevron-down"></span>Internet Access Required</a>
       <ul class="nav nav-list">
        <li><a href="../data/proxy.html">Proxy</a></li>
        <li><a href="../data/mirrornvd.html">Mirroring NVD</a></li>
        <li><a href="../data/cachenvd.html">Snapshotting the NVD</a></li>
        <li class="active"><a>Caching the Database</a></li>
        <li><a href="../data/database.html">Central DB</a></li>
        <li><a href="../data/ossindex.html">Sonatype OSS Index</a></li>
       </ul></li>
      <li><a href="../related.html">Related Work</a></li>
      <li><a href="../general/dependency-check.pptx">Project Presentation (pptx)</a></li>
      <li><a href="../general/dependency-check.pdf">Project Presentation (pdf)</a></li>
      <li><a href="../general/SampleReport.html">Sample Report</a></li>
      <li><a href="../general/scan_iso.html">How to Scan an ISO Image</a></li>
     </ul></li>
    <li><a href="../analyzers/index.html"><span class="icon-chevron-right"></span>File Type Analyzers</a></li>
    <li><a href="../modules.html"><span class="icon-chevron-right"></span>Modules</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
    <div id="twitter" style="border:none; margin-top: 10px">
    <a href="https://twitter.com/ctxt" class="twitter-follow-button" data-show-count="true" data-align="left" data-size="medium" data-show-screen-name="true" data-lang="en" data-dnt="true" >Follow ctxt</a>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    </div>
              <div class="clear"></div>
<a href="https://www.ej-technologies.com/products/jprofiler/overview.html" class="builtBy"><img class="builtBy" src="https://jeremylong.github.io/DependencyCheck/images/logos/jprofiler.png" alt="JProfiler Java Profiler" style="width: 170px;" /></a>
<a href="http://www.jetbrains.com/idea/" class="builtBy"><img class="builtBy" src="https://jeremylong.github.io/DependencyCheck/images/logos/logo_intellij_idea.png" alt="developed using IntelliJ" style="width: 170px;" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn" class="span10">
<section><a id="Caching_ODC.27s_H2_Database"></a>
<h1>Caching ODC's H2 Database</h1>
<p>Many users of dependency-check ensure that ODC runs as fast as possible by caching
the entire <code>data</code> directory, including the H2 database (<code>odc.mv.db</code>).</p>
<p>The location of the <code>data</code> directory is different for each integration (cli, maven, gradle, etc.), however each
integration allows users to configure this location.</p>
<p>There are two primary strategies used:</p><section><a id="Single_node_database_updater_with_multiple_node_.E2.80.9Creaders.E2.80.9D"></a>
<h2>Single node database updater with multiple node &#x201c;readers&#x201d;</h2>
<p>Use a single node to build the database using the integration in &#x201c;update only&#x201d; mode
(e.g., <code>--updateOnly</code> for the cli) and specify the data directory location (see
the configuration documentation for each integration's configuration).</p>
<p>The <code>data</code> directory is then archived somewhere accessible to all nodes, usually using one of two common caching
strategies:</p>
<ol style="list-style-type: decimal;">

<li>
<p><strong>Use shared disk storage (e.g network mounted)</strong></p>
<p>Subsequent nodes point directly to the same mounted storage being written to by the single node updater.</p></li>
<li>
<p><strong>Use a common artifact storage location/repository</strong></p>
<p>Subsequent nodes will download the archived <code>data</code> directory before scanning and unpack to the relevant location.</p></li>
</ol>
<p>The &#x201c;reader&#x201d; nodes are configured with <code>--noupdate</code> (or the related configuration to disable the updates in each
integration) so they are not reliant on outgoing calls.</p>
<p>The cached <code>data</code> directory (and H2 database) is generally updated by the single node/process daily in this use
case - but could be designed with a more frequent update.</p>
<p>This approach is often used when:</p>
<ul>

<li>updating of database/cache needs to be centrally controlled/co-ordinated</li>
<li>internet access is not available to all nodes/users, and perhaps only available centrally or difficult to
configure (e.g proxied environments)</li>
<li>nodes/users of ODC data cannot safely collaborate on a shared cache without affecting one another</li>
</ul></section><section><a id="Multiple_node_database_updaters_collaborating_on_a_common_cache_location"></a>
<h2>Multiple node database updaters collaborating on a common cache location</h2>
<p>Instead of having only a single update node - all nodes are allowed to update the database if necessary. However
the entire <code>data</code> directory is zipped and stored in a common location, including the H2 database, <code>cache</code>, and in
some cases cached data from multiple upstream sources.</p>
<p>There are two common caching strategies here:</p>
<ol style="list-style-type: decimal;">

<li>
<p><strong>Use shared disk storage (e.g network mounted)</strong></p>
<p>Every node is pointed to writeable shared storage, e.g network mounted. ODC creates an update lock file within
the shared storage when any individual node is updating, and other nodes will wait for the lock to be released.</p></li>
<li>
<p><strong>Use a common artifact storage location/repository</strong></p>
<p>Prior to running ODC, each node downloads the latest version of the archived <code>data</code> directory from the shared
artifact storage and unpacks it to the relevant location.</p>
<p>They then execute a scan (with updates enabled) and if successful the updated <code>data</code> directory is archived and
uploaded to the common location for use by the next node.</p></li>
</ol>
<p>Since this strategy allows all nodes to update the common cache to be effective</p>
<ul>

<li>it does not help if nodes download from the common cache, but dont share the updated cache with others by uploading</li>
<li>it requires some degree of consistency in how all nodes configure ODC to ensure the cache is not corrupted by others</li>
</ul>
<p>This approach is usually used when:</p>
<ul>

<li>ensuring data is updated more deterministically after validity period expiry is desirable (e.g <code>nvdValidForHours</code>)</li>
<li>configuring ODC with single writer and multiple reader strategies adds excessive friction</li>
<li>reliance on a centralised updater is undesirable and a more de-centralised approach is useful</li>
</ul></section><section><a id="Additional_Notes"></a>
<h2>Additional Notes</h2>
<p>The <code>data</code> directory may also contain cached data from other upstream sources, depending
on which analyzers are enabled. Ensuring that file modification times are retained during
archiving and un-archiving will make these safe to cache, which is especially important in
a multi-node update strategy.</p></section></section>        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>©      2012–2025
<a href="https://www.owasp.org">OWASP</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>
