<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SeverityUtil.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Dependency-Check Core</a> &gt; <a href="index.source.html" class="el_package">org.owasp.dependencycheck.utils</a> &gt; <span class="el_source">SeverityUtil.java</span></div><h1>SeverityUtil.java</h1><pre class="source lang-java linenums">/*
 * This file is part of dependency-check-core.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Copyright (c) 2019 Jeremy Long. All Rights Reserved.
 */
package org.owasp.dependencycheck.utils;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * Utility to estimate severity level scores.
 *
 * @author Jeremy Long
 */
public final class SeverityUtil {

    /**
     * The logger.
     */
<span class="fc" id="L33">    private static final Logger LOGGER = LoggerFactory.getLogger(SeverityUtil.class);</span>

    /**
     * Private constructor for a utility class.
     */
    private SeverityUtil() {
        //noop
    }

    /**
     * Estimates the CVSS V2 Score based on a given severity. The implementation
     * will default to 3.9 if no recognized &quot;severity&quot; level is given (critical,
     * high, low).
     *
     * @param severity the severity text (e.g. &quot;medium&quot;)
     * @return a score from 0 to 10
     */
    public static float estimateCvssV2(String severity) {
<span class="fc bfc" id="L51" title="All 6 branches covered.">        switch (severity == null ? &quot;none&quot; : severity.toLowerCase()) {</span>
            case &quot;critical&quot;:
            case &quot;high&quot;:
<span class="fc" id="L54">                return 10.0f;</span>
            case &quot;moderate&quot;:
            case &quot;medium&quot;:
<span class="fc" id="L57">                return 6.9f;</span>
            case &quot;info&quot;:
            case &quot;informational&quot;:
<span class="fc" id="L60">                return 0.0f;</span>
            case &quot;low&quot;:
            case &quot;unknown&quot;:
            case &quot;none&quot;:
            default:
<span class="fc" id="L65">                return 3.9f;</span>
        }
    }

    /**
     * Converts a textual severity to the text that should be used to signal
     * it in a report.
     * @param severity The textual unscored severity
     * @return The severity when properly recognized, otherwise the severity extended with a remark that it was not recognized and
     *  assumed to represent a critical severity.
     */
    public static String unscoredToSeveritytext(final String severity) {
<span class="pc bpc" id="L77" title="1 of 2 branches missed.">        switch (Severity.forUnscored(severity)) {</span>
            case CRITICAL:
            case HIGH:
            case MEDIUM:
            case LOW:
            case INFO:
<span class="fc" id="L83">                return severity;</span>
            case ASSUMED_CRITICAL:
            default:
                final String sevText;
<span class="nc bnc" id="L87" title="All 2 branches missed.">                if (&quot;0.0&quot;.equals(severity)) {</span>
<span class="nc" id="L88">                    sevText = &quot;Unknown&quot;;</span>
                } else {
<span class="nc" id="L90">                    sevText = severity;</span>
                }
<span class="nc" id="L92">                return sevText + &quot; (not recognized; assumed to be critical)&quot;;</span>
        }
    }

    /**
     * Creates an estimated sort-adjusted CVSSv3 score for an unscored textual severity.
     * For recognized severities below critical it returns a value at the lower bound of the CVSSv3 baseScore for that severity.
     * For recognized critical severities it returns a score in-between the upper bound of the HIGH CVSSv2 score and the lowest
     * sort-adjusted CVSSv3 critical score, so that unscored critical vulnerabilties are ordered in between CRITICAL scored CVSSv3
     * rated vulnerabilities and HIGH-scored CVSSv2 rated vulnerabilities.
     * For unrecognized severities it returns a score in-between the top HIGH CVSSv2 score and the estimatedSortAdjustedCVSSv3
     * score for an unscored severity recognized as critical, so that recognized critical will win over unrecognized severities
     * while unrecognized severities are assumed to be of a critical nature.
     *
     * @param severity The textual severity, may be null
     * @return A float that can be used to numerically sort vulnerabilities in approximated severity (highest float represents
     * highest severity).
     * @see #sortAdjustedCVSSv3BaseScore(float)
     */
    public static float estimatedSortAdjustedCVSSv3(final String severity) {
<span class="pc bpc" id="L112" title="1 of 6 branches missed.">        switch (Severity.forUnscored(severity)) {</span>
            case CRITICAL:
<span class="fc" id="L114">                return 10.2f;</span>
            case HIGH:
<span class="fc" id="L116">                return 7.0f;</span>
            case MEDIUM:
<span class="fc" id="L118">                return 4.0f;</span>
            case LOW:
<span class="fc" id="L120">                return 0.1f;</span>
            case INFO:
<span class="nc" id="L122">                return 0.0f;</span>
            case ASSUMED_CRITICAL:
            default:
<span class="fc" id="L125">                SeverityUtil.LOGGER.debug(&quot;Unrecognized unscored textual severity: {}, assuming critical score as worst-case &quot;</span>
                                           + &quot;estimate for sorting&quot;,
                                           severity);
<span class="fc" id="L128">                return 10.1f;</span>
        }
    }

    /**
     * Compute an adjusted CVSSv3 baseScore that ensures that CRITICAL CVSSv3 scores will win over HIGH CVSSv2 and CRITICAL
     * unscored severities to allow for a best-effort sorting that enables the report to list a reliable 'highest severity'
     * in the report.
     *
     * @param cvssV3BaseScore The cvssV3 baseScore severity of a vulnerability
     * @return The cvssV3 baseScore, adjusted if necessary in order to guarantee that CVSSv3 CRITICAL scores will rate higher than
     * CVSSv2 HIGH, unscored critical severities and unscored unrecognized severities (which are assumed for sorting to be of a
     * critical nature)
     * @see #estimatedSortAdjustedCVSSv3(String)
     */
    public static float sortAdjustedCVSSv3BaseScore(final float cvssV3BaseScore) {
<span class="fc bfc" id="L144" title="All 2 branches covered.">        if (cvssV3BaseScore &gt;= 9.0f) {</span>
<span class="fc" id="L145">            return cvssV3BaseScore + 1.3f;</span>
        }
<span class="fc" id="L147">        return cvssV3BaseScore;</span>
    }

    /**
     * An enum to translate unscored severity texts to a severity level of a defined set of severities.
     * Allows for re-use of the text-to-severity mapping in multiple helper methods.
     */
<span class="fc" id="L154">    private enum Severity {</span>
        /**
         * A severity level for textual values that should be regarded as accompanying a critical severity vulnerability
         */
<span class="fc" id="L158">        CRITICAL,</span>
        /**
         * A severity level for textual values that are not recognized and therefor assumed to be accompanying a critical severity
         * vulnerability
         */
<span class="fc" id="L163">        ASSUMED_CRITICAL,</span>
        /**
         * A severity level for textual values that should be regarded as accompanying a high severity vulnerability
         */
<span class="fc" id="L167">        HIGH,</span>
        /**
         * A severity level for textual values that should be regarded as accompanying a medium severity vulnerability
         */
<span class="fc" id="L171">        MEDIUM,</span>
        /**
         * A severity level for textual values that should be regarded as accompanying a low severity vulnerability
         */
<span class="fc" id="L175">        LOW,</span>
        /**
         * A severity level for textual values that should be regarded as accompanying a vulnerability of informational nature
         */
<span class="fc" id="L179">        INFO;</span>

        public static Severity forUnscored(String value) {
<span class="pc bpc" id="L182" title="2 of 8 branches missed.">            switch (value == null ? &quot;none&quot; : value.toLowerCase()) {</span>
            case &quot;critical&quot;:
<span class="fc" id="L184">                return CRITICAL;</span>
            case &quot;high&quot;:
<span class="fc" id="L186">                return HIGH;</span>
            case &quot;moderate&quot;:
            case &quot;medium&quot;:
<span class="fc" id="L189">                return MEDIUM;</span>
            case &quot;info&quot;:
            case &quot;informational&quot;:
<span class="nc" id="L192">                return INFO;</span>
            case &quot;low&quot;:
            case &quot;unknown&quot;:
            case &quot;none&quot;:
<span class="fc" id="L196">                return LOW;</span>
            default:
<span class="fc" id="L198">                return ASSUMED_CRITICAL;</span>
            }
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>